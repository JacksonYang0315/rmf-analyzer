<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Analyze z/OS RMF Workload Activity reports for FISC policy TFP analysis">
  <meta name="theme-color" content="#0a0a0f">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“Š</text></svg>">
  <title>RMF Workload Activity Analyzer</title>

  <!-- Fonts: JetBrains Mono (display/mono) + Space Grotesk (body) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

  <!-- DataTables -->
  <link href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css" rel="stylesheet">

  <!-- Custom Styles -->
  <link rel="stylesheet" href="static/css/style.css">
</head>
<body>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Loading Overlay -->
<div class="loading-overlay hidden" id="loadingOverlay">
  <div class="text-center">
    <div class="spinner"></div>
    <div class="loading-text" id="loadingText">Loading...</div>
    <div class="loading-progress">
      <div class="loading-progress-bar"></div>
    </div>
  </div>
</div>

<!-- Navbar -->
<nav class="navbar-modern">
  <div class="navbar-content">
    <a href="#" class="navbar-brand">
      <svg class="brand-logo" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="2" y="2" width="28" height="28" rx="4" stroke="#33ff66" stroke-width="1" opacity="0.4"/>
        <path d="M8 22V14" stroke="#33ff66" stroke-width="2" stroke-linecap="round"/>
        <path d="M13 22V10" stroke="#33ff66" stroke-width="2" stroke-linecap="round" opacity="0.7"/>
        <path d="M18 22V16" stroke="#33ff66" stroke-width="2" stroke-linecap="round"/>
        <path d="M23 22V8" stroke="#ffb800" stroke-width="2" stroke-linecap="round"/>
        <circle cx="8" cy="14" r="1.5" fill="#33ff66"/>
        <circle cx="13" cy="10" r="1.5" fill="#33ff66" opacity="0.7"/>
        <circle cx="18" cy="16" r="1.5" fill="#33ff66"/>
        <circle cx="23" cy="8" r="1.5" fill="#ffb800"/>
      </svg>
      <span data-i18n="brand">z/OS RMF Workload Analyzer</span>
    </a>
    <div class="d-flex align-center gap-2">
      <span class="navbar-badge" id="headerBadge">-- records</span>
      <!-- Language Toggle -->
      <button class="lang-toggle" id="btnLangToggle" title="Switch Language" aria-label="Switch language">
        <span class="lang-toggle-label" id="langLabel">ä¸­</span>
      </button>
      <button class="navbar-filter-toggle" id="btnFilterToggle" title="Filters" aria-label="Toggle filters">
        <i class="bi bi-sliders"></i>
        <span class="filter-active-dot"></span>
      </button>
    </div>
  </div>
</nav>

<!-- Mobile Filter Drawer -->
<div class="filter-drawer-overlay" id="filterDrawerOverlay"></div>
<div class="filter-drawer" id="filterDrawer" role="dialog" aria-label="Filters">
  <div class="filter-drawer-handle" id="filterDrawerHandle"></div>
  <div class="filter-drawer-content">
    <div class="filter-drawer-header">
      <span class="filter-drawer-title">
        <i class="bi bi-funnel"></i> <span data-i18n="filters">Filters</span>
      </span>
      <button class="filter-drawer-close" id="btnFilterDrawerClose" aria-label="Close filters">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    <div class="filter-group">
      <label class="form-label" data-i18n="sourceFile">Source File</label>
      <select id="mobileFilterSource" class="form-select">
            <option value="" data-i18n="allFiles">All Files</option>
          </select>
    </div>
    <div class="filter-group">
      <label class="form-label" data-i18n="workload">Workload</label>
      <select id="mobileFilterWorkload" class="form-select">
            <option value="" data-i18n="allWorkloads">All Workloads</option>
          </select>
    </div>
    <div class="filter-group">
      <label class="form-label" data-i18n="serviceClass">Service Class</label>
      <select id="mobileFilterSvcClass" class="form-select">
            <option value="" data-i18n="allClasses">All Classes</option>
          </select>
    </div>
    <div class="filter-group">
      <label class="form-label" data-i18n="startDate">Start Date</label>
      <input type="datetime-local" id="mobileFilterStart" class="form-input">
    </div>
    <div class="filter-group">
      <label class="form-label" data-i18n="endDate">End Date</label>
      <input type="datetime-local" id="mobileFilterEnd" class="form-input">
    </div>
    <div class="filter-drawer-actions">
      <button class="btn btn-secondary" id="btnMobileReset">
        <i class="bi bi-arrow-counterclockwise"></i> <span data-i18n="reset">Reset</span>
      </button>
      <button class="btn btn-primary" id="btnMobileApply">
        <i class="bi bi-search"></i> <span data-i18n="apply">Apply</span>
      </button>
    </div>
    <div style="margin-top: var(--space-md);">
      <button class="btn btn-success w-full" id="btnMobileExport">
        <i class="bi bi-download"></i> <span data-i18n="exportCsv">Export CSV</span>
      </button>
    </div>
    <div style="margin-top: var(--space-sm);">
      <button class="btn btn-ghost w-full" id="btnMobileUploadDrawer">
        <i class="bi bi-plus-circle"></i> <span data-i18n="uploadMore">Upload More Files</span>
      </button>
    </div>
  </div>
</div>

<!-- Main Content -->
<main class="main-container">

  <!-- Upload Section -->
  <section id="uploadSection" class="upload-section fade-in">
    <div class="card">
      <div class="card-body">
        <!-- Terminal header -->
        <div class="system-status" id="systemStatus">
          <span class="status-dot"></span>
          <span>RMF PARSER v3.0 CLIENT</span>
          <span style="color: var(--text-muted);">|</span>
          <span>READY</span>
          <span style="color: var(--text-muted);">|</span>
          <span id="systemClock" style="color: var(--amber);"></span>
        </div>

        <div class="text-center mb-3">
          <h2 class="card-title" style="justify-content: center;">
            <i class="bi bi-terminal"></i>
            <span data-i18n="uploadTitle">Upload RMF Reports</span>
          </h2>
          <p class="text-muted" style="font-size: 0.8125rem;" data-i18n="uploadDesc">Parse and analyze z/OS RMF Workload Activity reports</p>
        </div>

        <!-- Back to Dashboard button -->
        <div id="backToDashboard" class="text-center mb-3" style="display: none;">
          <button class="btn btn-secondary" id="btnBackToDashboard">
            <i class="bi bi-arrow-left"></i>
            <span data-i18n="backToDashboard">Back to Dashboard</span>
          </button>
        </div>

        <!-- Upload Zone -->
        <div class="upload-zone mb-3" id="dropZone">
          <div class="upload-zone-icon">
            <i class="bi bi-cpu"></i>
          </div>
          <h3 data-i18n="dropFiles">Drop your RMF files here</h3>
          <p data-i18n="orBrowse">or click to browse files (.txt)</p>
          <label class="file-input-wrapper" for="fileInput">
            <input type="file" id="fileInput" class="file-input-native" multiple accept=".txt">
            <span class="btn btn-primary btn-lg file-input-btn" aria-hidden="true">
              <i class="bi bi-folder2-open"></i>
              <span data-i18n="selectFiles">Select Files</span>
            </span>
          </label>
        </div>

        <!-- Client-side privacy notice -->
        <div class="text-center mb-3" style="font-size: 0.7rem; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; opacity: 0.7;">
          <i class="bi bi-shield-lock"></i>
          <span data-i18n="clientOnlyNotice">Files are processed locally in your browser and are never uploaded to any server.</span>
        </div>

        <!-- Selected Files -->
        <div id="fileListSection" class="mb-3" style="display: none;">
          <h4 style="font-size: 0.8125rem; font-weight: 700; margin-bottom: var(--space-md); font-family: 'JetBrains Mono', monospace; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.06em;" data-i18n="selectedFiles">Selected Files</h4>
          <div id="fileList" class="file-list"></div>
        </div>

        <!-- Actions -->
        <div id="uploadActions" style="display: none;">
          <div class="d-flex align-center gap-3 flex-wrap">
            <button class="btn btn-success btn-lg" id="btnUpload">
              <i class="bi bi-upload"></i>
              <span data-i18n="uploadParse">Upload & Parse</span>
            </button>
            <button class="btn btn-secondary" id="btnClearFiles">
              <i class="bi bi-x-lg"></i>
              <span data-i18n="clear">Clear</span>
            </button>
          </div>
        </div>

        <!-- Status -->
        <div id="uploadStatus" class="mt-3"></div>

        <!-- Existing Files -->
        <div id="existingFilesSection" class="mt-3" style="display: none; border-top: 1px solid var(--border-dim); padding-top: var(--space-lg);">
          <h4 style="font-size: 0.8125rem; font-weight: 700; margin-bottom: var(--space-md); font-family: 'JetBrains Mono', monospace; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.06em;">
            <i class="bi bi-folder-check"></i>
            <span data-i18n="uploadedFiles">Uploaded Files</span>
          </h4>
          <div id="existingFiles" class="file-list"></div>
          <button class="btn btn-danger mt-2" id="btnClearAll">
            <i class="bi bi-trash"></i>
            <span data-i18n="clearAll">Clear All Files</span>
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Data Dashboard -->
  <section id="dataSection" style="display: none;">

    <!-- Mobile Upload Button -->
    <div class="mobile-upload-btn-wrapper" style="margin-bottom: var(--space-md);">
      <button class="btn btn-primary w-full" id="btnMobileUploadMore" style="min-height: 48px;">
        <i class="bi bi-cloud-arrow-up"></i>
        <span data-i18n="uploadNew">Upload New Files</span>
      </button>
    </div>

    <!-- Stats Row -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon blue">
          <i class="bi bi-database"></i>
        </div>
        <div class="stat-value" id="statRecords">--</div>
        <div class="stat-label" data-i18n="totalRecords">Total Records</div>
      </div>

      <div class="stat-card warning">
        <div class="stat-icon amber">
          <i class="bi bi-funnel"></i>
        </div>
        <div class="stat-value" id="statFiltered">--</div>
        <div class="stat-label" data-i18n="filtered">Filtered</div>
      </div>

      <div class="stat-card success">
        <div class="stat-icon green">
          <i class="bi bi-files"></i>
        </div>
        <div class="stat-value" id="statFiles">--</div>
        <div class="stat-label" data-i18n="filesParsed">Files Parsed</div>
      </div>

      <div class="stat-card info">
        <div class="stat-icon purple">
          <i class="bi bi-layers"></i>
        </div>
        <div class="stat-value" id="statClasses">--</div>
        <div class="stat-label" data-i18n="serviceClasses">Service Classes</div>
      </div>
    </div>

    <!-- Dashboard Grid -->
    <div class="dashboard-grid">
      <!-- Filters Panel -->
      <aside class="filters-panel">
        <h3 class="filters-title">
          <i class="bi bi-funnel"></i>
          <span data-i18n="filters">Filters</span>
        </h3>

        <div class="filter-group">
          <label class="form-label" data-i18n="sourceFile">Source File</label>
          <select id="filterSource" class="form-select">
            <option value="" data-i18n="allFiles">All Files</option>
          </select>
        </div>

        <div class="filter-group">
          <label class="form-label" data-i18n="workload">Workload</label>
          <select id="filterWorkload" class="form-select">
            <option value="" data-i18n="allWorkloads">All Workloads</option>
          </select>
        </div>

        <div class="filter-group">
          <label class="form-label" data-i18n="serviceClass">Service Class</label>
          <select id="filterSvcClass" class="form-select">
            <option value="" data-i18n="allClasses">All Classes</option>
          </select>
        </div>

        <div class="filter-group">
          <label class="form-label" data-i18n="startDate">Start Date</label>
          <input type="datetime-local" id="filterStart" class="form-input">
        </div>

        <div class="filter-group">
          <label class="form-label" data-i18n="endDate">End Date</label>
          <input type="datetime-local" id="filterEnd" class="form-input">
        </div>

        <div class="d-flex flex-column gap-2">
          <button class="btn btn-primary w-full" id="btnApply">
            <i class="bi bi-search"></i>
            <span data-i18n="applyFilters">Apply Filters</span>
          </button>
          <button class="btn btn-secondary w-full" id="btnReset">
            <i class="bi bi-arrow-counterclockwise"></i>
            <span data-i18n="reset">Reset</span>
          </button>
          <button class="btn btn-success w-full" id="btnExport">
            <i class="bi bi-download"></i>
            <span data-i18n="exportCsv">Export CSV</span> <kbd class="hide-mobile">Ctrl+E</kbd>
          </button>
          <button class="btn btn-ghost w-full" id="btnUploadMore">
            <i class="bi bi-plus-circle"></i>
            <span data-i18n="uploadMore">Upload More</span>
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <div>
        <!-- Chart -->
        <div class="chart-container mb-3">
          <h3 class="card-title mb-2">
            <i class="bi bi-graph-up"></i>
            <span data-i18n="chartTitle">APPL % CP Trend by Service Class</span>
          </h3>
          <div class="chart-wrapper">
            <canvas id="cpuChart"></canvas>
          </div>
        </div>

        <!-- Table -->
        <div class="table-container">
          <h3 class="card-title mb-2">
            <i class="bi bi-table"></i>
            <span data-i18n="tableTitle">Detailed Records</span>
          </h3>
          <div style="overflow-x: auto;">
            <table id="dataTable" class="data-table">
              <thead>
                <tr>
                  <th data-i18n="colDateTime">Date-Time</th>
                  <th data-i18n="colServiceClass">Service Class</th>
                  <th data-i18n="colWorkload">Workload</th>
                  <th data-i18n="colPeriod">Period</th>
                  <th data-i18n="colApplCp">APPL % CP</th>
                  <th data-i18n="colSource">Source</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Mobile Card View -->
        <div class="mobile-cards-container" id="mobileCardsContainer">
          <h3 class="card-title mb-2">
            <i class="bi bi-table"></i>
            <span data-i18n="tableTitle">Detailed Records</span>
          </h3>
          <input type="text" class="mobile-cards-search" id="mobileCardsSearch" data-i18n="dtSearchPlaceholder" placeholder="Search records...">
          <div id="mobileCardsContent"></div>
          <div class="mobile-cards-pagination" id="mobileCardsPagination"></div>
        </div>
      </div>
    </div>
  </section>

</main>

<footer style="text-align: center; padding: var(--space-lg); color: var(--text-muted); font-size: 0.6875rem; font-family: 'JetBrains Mono', monospace; letter-spacing: 0.04em;">
  <span data-i18n="footer">RMF Workload Activity Analyzer &mdash; z/OS Performance Analytics</span>
</footer>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

<!-- Client-side RMF Parser -->
<script src="static/js/parser.js"></script>
<!-- App JS -->
<script src="static/js/app.js"></script>

</body>
</html>
